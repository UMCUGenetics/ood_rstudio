# Export the module function if it exists
[[ $(type -t module) == "function" ]] && export -f module

# specify path to container
workspace=<%= context.bc_path %>
export APPTAINER_CACHEDIR=${workspace}/.apptainer
echo $APPTAINER_CACHEDIR

<% if context.source == "bioconductor" -%>
apptainer pull --dir $TMPDIR rstudio.sif docker://bioconductor/bioconductor_docker:<%= context.bioc_version %>
<% else -%>
apptainer pull --dir $TMPDIR rstudio.sif docker://rocker/geospatial:<%= context.r_version %>
<% end -%>

export SIF=${TMPDIR}/rstudio.sif

# Find available port to run server on
port=$(find_port $host)

# Define a password and export it for RStudio authentication
password=$(create_passwd 16)
export RSTUDIO_PASSWORD=$password

# Generate CSRF token for RStudio
<%- require 'securerandom'
    csrftoken = SecureRandom.uuid -%>
export csrftoken=<%= csrftoken %>
